<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="DEPARTAMENTO DE ENGENHARIA INFORMÁTICA">

<title>C++ 3rd Person Battery Collector Power Up Game</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="battery_collector_quarto_files/libs/clipboard/clipboard.min.js"></script>
<script src="battery_collector_quarto_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="battery_collector_quarto_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="battery_collector_quarto_files/libs/quarto-html/popper.min.js"></script>
<script src="battery_collector_quarto_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="battery_collector_quarto_files/libs/quarto-html/anchor.min.js"></script>
<link href="battery_collector_quarto_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="battery_collector_quarto_files/libs/quarto-html/quarto-syntax-highlighting-4a990d8dcb58f517c7c86712b8f2ac7c.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="battery_collector_quarto_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="battery_collector_quarto_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="battery_collector_quarto_files/libs/bootstrap/bootstrap-e52c317b831d71bd0833fd401c29266f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#building-the-base-level" id="toc-building-the-base-level" class="nav-link" data-scroll-target="#building-the-base-level"><span class="header-section-number">2</span> Building the Base Level</a>
  <ul class="collapse">
  <li><a href="#setting-up-the-project" id="toc-setting-up-the-project" class="nav-link" data-scroll-target="#setting-up-the-project"><span class="header-section-number">2.1</span> Setting Up the Project</a></li>
  <li><a href="#importing-content-from-content-examples" id="toc-importing-content-from-content-examples" class="nav-link" data-scroll-target="#importing-content-from-content-examples"><span class="header-section-number">2.2</span> Importing Content from Content Examples</a></li>
  <li><a href="#setting-up-the-level" id="toc-setting-up-the-level" class="nav-link" data-scroll-target="#setting-up-the-level"><span class="header-section-number">2.3</span> Setting Up the Level</a></li>
  <li><a href="#level-design-setup" id="toc-level-design-setup" class="nav-link" data-scroll-target="#level-design-setup"><span class="header-section-number">2.4</span> Level Design Setup</a></li>
  </ul></li>
  <li><a href="#making-your-first-pickup-class" id="toc-making-your-first-pickup-class" class="nav-link" data-scroll-target="#making-your-first-pickup-class"><span class="header-section-number">3</span> Making Your First Pickup Class</a>
  <ul class="collapse">
  <li><a href="#creating-the-base-pickup-class" id="toc-creating-the-base-pickup-class" class="nav-link" data-scroll-target="#creating-the-base-pickup-class"><span class="header-section-number">3.1</span> Creating the Base Pickup Class</a></li>
  <li><a href="#pickup-header-file-pickup.h" id="toc-pickup-header-file-pickup.h" class="nav-link" data-scroll-target="#pickup-header-file-pickup.h"><span class="header-section-number">3.2</span> Pickup Header File (Pickup.h)</a></li>
  <li><a href="#pickup-source-file-pickup.cpp" id="toc-pickup-source-file-pickup.cpp" class="nav-link" data-scroll-target="#pickup-source-file-pickup.cpp"><span class="header-section-number">3.3</span> Pickup Source File (Pickup.cpp)</a></li>
  <li><a href="#creating-a-blueprint-from-the-pickup-class" id="toc-creating-a-blueprint-from-the-pickup-class" class="nav-link" data-scroll-target="#creating-a-blueprint-from-the-pickup-class"><span class="header-section-number">3.4</span> Creating a Blueprint from the Pickup Class</a></li>
  </ul></li>
  <li><a href="#extending-the-pickup-class" id="toc-extending-the-pickup-class" class="nav-link" data-scroll-target="#extending-the-pickup-class"><span class="header-section-number">4</span> Extending the Pickup Class</a>
  <ul class="collapse">
  <li><a href="#creating-the-battery-pickup-class" id="toc-creating-the-battery-pickup-class" class="nav-link" data-scroll-target="#creating-the-battery-pickup-class"><span class="header-section-number">4.1</span> Creating the Battery Pickup Class</a></li>
  <li><a href="#battery-pickup-header-file-batterypickup.h" id="toc-battery-pickup-header-file-batterypickup.h" class="nav-link" data-scroll-target="#battery-pickup-header-file-batterypickup.h"><span class="header-section-number">4.2</span> Battery Pickup Header File (BatteryPickup.h)</a></li>
  <li><a href="#battery-pickup-source-file-batterypickup.cpp" id="toc-battery-pickup-source-file-batterypickup.cpp" class="nav-link" data-scroll-target="#battery-pickup-source-file-batterypickup.cpp"><span class="header-section-number">4.3</span> Battery Pickup Source File (BatteryPickup.cpp)</a></li>
  <li><a href="#setting-up-battery-collision" id="toc-setting-up-battery-collision" class="nav-link" data-scroll-target="#setting-up-battery-collision"><span class="header-section-number">4.4</span> Setting Up Battery Collision</a></li>
  <li><a href="#creating-battery-blueprint" id="toc-creating-battery-blueprint" class="nav-link" data-scroll-target="#creating-battery-blueprint"><span class="header-section-number">4.5</span> Creating Battery Blueprint</a></li>
  </ul></li>
  <li><a href="#creating-the-spawning-volume" id="toc-creating-the-spawning-volume" class="nav-link" data-scroll-target="#creating-the-spawning-volume"><span class="header-section-number">5</span> Creating the Spawning Volume</a>
  <ul class="collapse">
  <li><a href="#spawn-volume-class" id="toc-spawn-volume-class" class="nav-link" data-scroll-target="#spawn-volume-class"><span class="header-section-number">5.1</span> Spawn Volume Class</a></li>
  <li><a href="#spawn-volume-header-file-spawnvolume.h" id="toc-spawn-volume-header-file-spawnvolume.h" class="nav-link" data-scroll-target="#spawn-volume-header-file-spawnvolume.h"><span class="header-section-number">5.2</span> Spawn Volume Header File (SpawnVolume.h)</a></li>
  <li><a href="#spawn-volume-source-file-spawnvolume.cpp" id="toc-spawn-volume-source-file-spawnvolume.cpp" class="nav-link" data-scroll-target="#spawn-volume-source-file-spawnvolume.cpp"><span class="header-section-number">5.3</span> Spawn Volume Source File (SpawnVolume.cpp)</a></li>
  </ul></li>
  <li><a href="#final-setup-and-polish" id="toc-final-setup-and-polish" class="nav-link" data-scroll-target="#final-setup-and-polish"><span class="header-section-number">6</span> Final Setup and Polish</a>
  <ul class="collapse">
  <li><a href="#creating-gamemode-blueprint" id="toc-creating-gamemode-blueprint" class="nav-link" data-scroll-target="#creating-gamemode-blueprint"><span class="header-section-number">6.1</span> Creating GameMode Blueprint</a></li>
  <li><a href="#character-collision-setup" id="toc-character-collision-setup" class="nav-link" data-scroll-target="#character-collision-setup"><span class="header-section-number">6.2</span> Character Collision Setup</a></li>
  <li><a href="#level-polish" id="toc-level-polish" class="nav-link" data-scroll-target="#level-polish"><span class="header-section-number">6.3</span> Level Polish</a></li>
  <li><a href="#hud-text-styling" id="toc-hud-text-styling" class="nav-link" data-scroll-target="#hud-text-styling"><span class="header-section-number">6.4</span> HUD Text Styling</a></li>
  </ul></li>
  <li><a href="#testing-the-complete-game" id="toc-testing-the-complete-game" class="nav-link" data-scroll-target="#testing-the-complete-game"><span class="header-section-number">7</span> Testing the Complete Game</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">8</span> Exercises</a>
  <ul class="collapse">
  <li><a href="#basic-extensions" id="toc-basic-extensions" class="nav-link" data-scroll-target="#basic-extensions"><span class="header-section-number">8.1</span> Basic Extensions</a></li>
  <li><a href="#intermediate-extensions" id="toc-intermediate-extensions" class="nav-link" data-scroll-target="#intermediate-extensions"><span class="header-section-number">8.2</span> Intermediate Extensions</a></li>
  <li><a href="#advanced-extensions" id="toc-advanced-extensions" class="nav-link" data-scroll-target="#advanced-extensions"><span class="header-section-number">8.3</span> Advanced Extensions</a></li>
  </ul></li>
  <li><a href="#troubleshooting" id="toc-troubleshooting" class="nav-link" data-scroll-target="#troubleshooting"><span class="header-section-number">9</span> Troubleshooting</a>
  <ul class="collapse">
  <li><a href="#common-issues" id="toc-common-issues" class="nav-link" data-scroll-target="#common-issues"><span class="header-section-number">9.1</span> Common Issues</a></li>
  <li><a href="#performance-considerations" id="toc-performance-considerations" class="nav-link" data-scroll-target="#performance-considerations"><span class="header-section-number">9.2</span> Performance Considerations</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">10</span> Conclusion</a></li>
  <li><a href="#source-reference" id="toc-source-reference" class="nav-link" data-scroll-target="#source-reference"><span class="header-section-number">11</span> Source Reference</a>
  <ul class="collapse">
  <li><a href="#adding-collection-functions" id="toc-adding-collection-functions" class="nav-link" data-scroll-target="#adding-collection-functions"><span class="header-section-number">11.1</span> Adding Collection Functions</a></li>
  <li><a href="#adding-pickup-collection-logic" id="toc-adding-pickup-collection-logic" class="nav-link" data-scroll-target="#adding-pickup-collection-logic"><span class="header-section-number">11.2</span> Adding Pickup Collection Logic</a></li>
  <li><a href="#setting-up-input" id="toc-setting-up-input" class="nav-link" data-scroll-target="#setting-up-input"><span class="header-section-number">11.3</span> Setting Up Input</a></li>
  <li><a href="#adding-wascollected-function-to-pickup" id="toc-adding-wascollected-function-to-pickup" class="nav-link" data-scroll-target="#adding-wascollected-function-to-pickup"><span class="header-section-number">11.4</span> Adding WasCollected Function to Pickup</a></li>
  </ul></li>
  <li><a href="#adding-power-to-the-game" id="toc-adding-power-to-the-game" class="nav-link" data-scroll-target="#adding-power-to-the-game"><span class="header-section-number">12</span> Adding Power to the Game</a>
  <ul class="collapse">
  <li><a href="#character-power-system" id="toc-character-power-system" class="nav-link" data-scroll-target="#character-power-system"><span class="header-section-number">12.1</span> Character Power System</a></li>
  <li><a href="#character-power-implementation" id="toc-character-power-implementation" class="nav-link" data-scroll-target="#character-power-implementation"><span class="header-section-number">12.2</span> Character Power Implementation</a></li>
  <li><a href="#powering-up-from-batteries" id="toc-powering-up-from-batteries" class="nav-link" data-scroll-target="#powering-up-from-batteries"><span class="header-section-number">12.3</span> Powering Up from Batteries</a></li>
  </ul></li>
  <li><a href="#gamemode-power-drain" id="toc-gamemode-power-drain" class="nav-link" data-scroll-target="#gamemode-power-drain"><span class="header-section-number">13</span> GameMode Power Drain</a>
  <ul class="collapse">
  <li><a href="#gamemode-power-system" id="toc-gamemode-power-system" class="nav-link" data-scroll-target="#gamemode-power-system"><span class="header-section-number">13.1</span> GameMode Power System</a></li>
  <li><a href="#gamemode-implementation" id="toc-gamemode-implementation" class="nav-link" data-scroll-target="#gamemode-implementation"><span class="header-section-number">13.2</span> GameMode Implementation</a></li>
  </ul></li>
  <li><a href="#character-visual-effects" id="toc-character-visual-effects" class="nav-link" data-scroll-target="#character-visual-effects"><span class="header-section-number">14</span> Character Visual Effects</a>
  <ul class="collapse">
  <li><a href="#material-color-changes" id="toc-material-color-changes" class="nav-link" data-scroll-target="#material-color-changes"><span class="header-section-number">14.1</span> Material Color Changes</a></li>
  <li><a href="#speed-changes" id="toc-speed-changes" class="nav-link" data-scroll-target="#speed-changes"><span class="header-section-number">14.2</span> Speed Changes</a></li>
  </ul></li>
  <li><a href="#creating-particle-effects" id="toc-creating-particle-effects" class="nav-link" data-scroll-target="#creating-particle-effects"><span class="header-section-number">15</span> Creating Particle Effects</a>
  <ul class="collapse">
  <li><a href="#electric-arc-material" id="toc-electric-arc-material" class="nav-link" data-scroll-target="#electric-arc-material"><span class="header-section-number">15.1</span> Electric Arc Material</a></li>
  <li><a href="#niagara-particle-system" id="toc-niagara-particle-system" class="nav-link" data-scroll-target="#niagara-particle-system"><span class="header-section-number">15.2</span> Niagara Particle System</a></li>
  <li><a href="#adding-particles-to-battery" id="toc-adding-particles-to-battery" class="nav-link" data-scroll-target="#adding-particles-to-battery"><span class="header-section-number">15.3</span> Adding Particles to Battery</a></li>
  </ul></li>
  <li><a href="#hud-system" id="toc-hud-system" class="nav-link" data-scroll-target="#hud-system"><span class="header-section-number">16</span> HUD System</a>
  <ul class="collapse">
  <li><a href="#enabling-umg" id="toc-enabling-umg" class="nav-link" data-scroll-target="#enabling-umg"><span class="header-section-number">16.1</span> Enabling UMG</a></li>
  <li><a href="#gamemode-hud-setup" id="toc-gamemode-hud-setup" class="nav-link" data-scroll-target="#gamemode-hud-setup"><span class="header-section-number">16.2</span> GameMode HUD Setup</a></li>
  <li><a href="#hud-blueprint" id="toc-hud-blueprint" class="nav-link" data-scroll-target="#hud-blueprint"><span class="header-section-number">16.3</span> HUD Blueprint</a></li>
  </ul></li>
  <li><a href="#game-states" id="toc-game-states" class="nav-link" data-scroll-target="#game-states"><span class="header-section-number">17</span> Game States</a>
  <ul class="collapse">
  <li><a href="#play-state-enum" id="toc-play-state-enum" class="nav-link" data-scroll-target="#play-state-enum"><span class="header-section-number">17.1</span> Play State Enum</a></li>
  <li><a href="#state-management-implementation" id="toc-state-management-implementation" class="nav-link" data-scroll-target="#state-management-implementation"><span class="header-section-number">17.2</span> State Management Implementation</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="battery_collector_quarto.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">C++ 3rd Person Battery Collector Power Up Game</h1>
<p class="subtitle lead">GAMES AND MULTIMEDIA - GAME ENGINES II</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>DEPARTAMENTO DE ENGENHARIA INFORMÁTICA </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Invalid Date</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>This assignment will introduce you to C++ programming and Unreal Engine 5 (UE5), including some of the Gameplay Framework classes. It will also show you some of the different ways to work with classes, functions, and variables that can help you with your project. This is just a jumping off point to get you started, but it is a mini game with both winning and losing.</p>
<p>As you will see, the character can collect batteries which are spawned by a Spawn Volume above the level. Your power increases as you collect the batteries, which changes your material and your running speed. However, the GameMode is also draining your character over time. You can lose power completely.</p>
<p>By the end of this assignment, you will have a number of classes including:</p>
<ul>
<li><strong>Base pickup</strong> - A battery pickup which fires lightning towards the character and gives some of its base power to the character</li>
<li><strong>Upgraded character</strong> - Has a Collection Sphere to collect all of the batteries within a certain radius of the character</li>
<li><strong>GameMode</strong> - Drains the character’s power over time and defines what happens when you win and when you lose during gameplay</li>
<li><strong>Spawn Volume</strong> - Spawns any kind of pickup whether it is a Base Pickup, a Battery Pickup, or some other kind of pickup that you develop on your own</li>
<li><strong>HUD</strong> - Set up using UMG (Unreal Motion Graphics) and has the power bar and the text at the top of the screen</li>
</ul>
</section>
<section id="building-the-base-level" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="building-the-base-level"><span class="header-section-number">2</span> Building the Base Level</h2>
<section id="setting-up-the-project" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="setting-up-the-project"><span class="header-section-number">2.1</span> Setting Up the Project</h3>
<p>Open the Games tab in the Unreal Project Browser. We are going to use a C++ template. Select <strong>Third Person</strong>. Leave the setup on Desktop. You can change the quality to Maximum Quality or Scalable, depending on your system setup.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The reason for not changing from Desktop to Mobile is that will change some of the inputs for your project.</p>
</div>
</div>
<p>You can either include Starter Content or not; we don’t need it for this assignment. However, if you want to take the project further, you can add Starter Content now or add it later with the add Feature Packs in the editor.</p>
<p><strong>Name the project “BatteryCollector”</strong>. If you name your project something different, you will have to adjust the code from the assignment. Click <strong>Create</strong>.</p>
</section>
<section id="importing-content-from-content-examples" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="importing-content-from-content-examples"><span class="header-section-number">2.2</span> Importing Content from Content Examples</h3>
<p>You need to use content from the Content Examples project. Download it from the Epic Games Launcher.</p>
<p>There are 2 things you are going to use from the Content Examples project: 1. A room for the character to run around 2. A battery mesh for our battery pickup</p>
<section id="migrating-the-demo-room" class="level4" data-number="2.2.1">
<h4 data-number="2.2.1" class="anchored" data-anchor-id="migrating-the-demo-room"><span class="header-section-number">2.2.1</span> Migrating the Demo Room</h4>
<p>In the Content Drawer, search for “BP_DemoRoom”. This is the room we are going to use.</p>
<ol type="1">
<li>Select <strong>BP_DemoRoom</strong> in the Content Drawer</li>
<li>Right-click, go to <strong>Asset Actions</strong> and select <strong>Migrate</strong></li>
<li>Click <strong>OK</strong> when the asset list appears</li>
<li>Navigate to your project: <code>UnrealProjects &gt; BatteryCollector &gt; Content</code></li>
<li>Click <strong>Select Folder</strong></li>
</ol>
</section>
<section id="migrating-the-battery-mesh" class="level4" data-number="2.2.2">
<h4 data-number="2.2.2" class="anchored" data-anchor-id="migrating-the-battery-mesh"><span class="header-section-number">2.2.2</span> Migrating the Battery Mesh</h4>
<p>Search for “Battery”. Select the <strong>SM_Battery_Medium</strong>. 1. Right-click, go to <strong>Asset Actions</strong>, and select <strong>Migrate</strong> 2. Click <strong>OK</strong> 3. The Content folder should still be selected, click <strong>OK</strong></p>
</section>
</section>
<section id="setting-up-the-level" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="setting-up-the-level"><span class="header-section-number">2.3</span> Setting Up the Level</h3>
<ol type="1">
<li>Create a new level: <strong>File → New Level → Basic</strong></li>
<li>Create a <strong>Maps</strong> folder within the Content folder</li>
<li>Save the level as “<strong>CollectionLevel</strong>” in the Maps folder</li>
</ol>
<section id="setting-default-maps" class="level4" data-number="2.3.1">
<h4 data-number="2.3.1" class="anchored" data-anchor-id="setting-default-maps"><span class="header-section-number">2.3.1</span> Setting Default Maps</h4>
<ol type="1">
<li>Click <strong>Edit → Project Settings</strong></li>
<li>Select <strong>Maps &amp; Modes</strong></li>
<li>Set both <strong>Game Default Map</strong> and <strong>Editor Startup Map</strong> to <strong>CollectionLevel</strong></li>
</ol>
</section>
</section>
<section id="level-design-setup" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="level-design-setup"><span class="header-section-number">2.4</span> Level Design Setup</h3>
<ol type="1">
<li>Delete the Floor from the World Outliner</li>
<li>Drag <strong>BP_DemoRoom</strong> into the level</li>
<li>Configure the room properties:
<ul>
<li>Set <strong>Width</strong> to 32</li>
<li>Uncheck <strong>Pillar</strong> and <strong>Sub Pillar</strong></li>
<li>Uncheck <strong>Enclosed Left</strong> (batteries will fall from the sky)</li>
</ul></li>
<li>Add a <strong>Player Start</strong> actor:
<ul>
<li><strong>Window → Place Actors</strong></li>
<li>Search for <strong>Player Start</strong> and drag it to the center of the room</li>
</ul></li>
</ol>
</section>
</section>
<section id="making-your-first-pickup-class" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="making-your-first-pickup-class"><span class="header-section-number">3</span> Making Your First Pickup Class</h2>
<section id="creating-the-base-pickup-class" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="creating-the-base-pickup-class"><span class="header-section-number">3.1</span> Creating the Base Pickup Class</h3>
<p>Use the C++ Class Wizard: <strong>Tools → New C++ Class</strong></p>
<ol type="1">
<li>Select <strong>Actor</strong> as the parent class</li>
<li>Name the class “<strong>Pickup</strong>”</li>
<li>Click <strong>Create Class</strong></li>
</ol>
</section>
<section id="pickup-header-file-pickup.h" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="pickup-header-file-pickup.h"><span class="header-section-number">3.2</span> Pickup Header File (Pickup.h)</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Fill out your copyright notice in the Description page of Project Settings.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma once</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"CoreMinimal.h"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"GameFramework/Actor.h"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"Pickup.generated.h"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>UCLASS<span class="op">()</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BATTERYCOLLECTOR_API APickup <span class="op">:</span> <span class="kw">public</span> AActor</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    GENERATED_BODY<span class="op">()</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span>    </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Sets default values for this actor's properties</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    APickup<span class="op">();</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span><span class="op">:</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Called when the game starts or when spawned</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">virtual</span> <span class="dt">void</span> BeginPlay<span class="op">()</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** True when the pickup can be used, and false when the pickup is deactivated */</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> bIsActive<span class="op">;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span>    </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Called every frame</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">virtual</span> <span class="dt">void</span> Tick<span class="op">(</span><span class="dt">float</span> DeltaTime<span class="op">)</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Return the mesh for the pickup */</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    FORCEINLINE UStaticMeshComponent<span class="op">*</span> GetMesh<span class="op">()</span> <span class="at">const</span> <span class="op">{</span> <span class="cf">return</span> PickupMesh<span class="op">;</span> <span class="op">}</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Return whether or not the pickup is active */</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    UFUNCTION<span class="op">(</span>BlueprintPure<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Pickup"</span><span class="op">)</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> IsActive<span class="op">();</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Allows other classes to safely change whether or not pickup is active */</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    UFUNCTION<span class="op">(</span>BlueprintCallable<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Pickup"</span><span class="op">)</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> SetActive<span class="op">(</span><span class="dt">bool</span> NewPickupState<span class="op">);</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Static mesh to represent the pickup in the level */</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    UPROPERTY<span class="op">(</span>VisibleAnywhere<span class="op">,</span> BlueprintReadOnly<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Pickup"</span><span class="op">,</span> meta <span class="op">=</span> <span class="op">(</span>allowprivateaccess <span class="op">=</span> <span class="kw">true</span><span class="op">))</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    UStaticMeshComponent<span class="op">*</span> PickupMesh<span class="op">;</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="pickup-source-file-pickup.cpp" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="pickup-source-file-pickup.cpp"><span class="header-section-number">3.3</span> Pickup Source File (Pickup.cpp)</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Fill out your copyright notice in the Description page of Project Settings.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"Pickup.h"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Sets default values</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>APickup<span class="op">::</span>APickup<span class="op">()</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set this actor to call Tick() every frame. You can turn this off to improve performance if you don't need it.</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    PrimaryActorTick<span class="op">.</span>bCanEverTick <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// All pickups start active</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    bIsActive <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create the static mesh component</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    PickupMesh <span class="op">=</span> CreateDefaultSubobject<span class="op">&lt;</span>UStaticMeshComponent<span class="op">&gt;(</span>TEXT<span class="op">(</span><span class="st">"PickupMesh"</span><span class="op">));</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    RootComponent <span class="op">=</span> PickupMesh<span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Called when the game starts or when spawned</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> APickup<span class="op">::</span>BeginPlay<span class="op">()</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    Super<span class="op">::</span>BeginPlay<span class="op">();</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Called every frame</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> APickup<span class="op">::</span>Tick<span class="op">(</span><span class="dt">float</span> DeltaTime<span class="op">)</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    Super<span class="op">::</span>Tick<span class="op">(</span>DeltaTime<span class="op">);</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Returns active state</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> APickup<span class="op">::</span>IsActive<span class="op">()</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> bIsActive<span class="op">;</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co">// Changes active state</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> APickup<span class="op">::</span>SetActive<span class="op">(</span><span class="dt">bool</span> NewPickupState<span class="op">)</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    bIsActive <span class="op">=</span> NewPickupState<span class="op">;</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="creating-a-blueprint-from-the-pickup-class" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="creating-a-blueprint-from-the-pickup-class"><span class="header-section-number">3.4</span> Creating a Blueprint from the Pickup Class</h3>
<ol type="1">
<li>Right-click on <strong>Pickup</strong> in C++ Classes</li>
<li>Select <strong>Create Blueprint class based on Pickup</strong></li>
<li>Name it “<strong>Pickup_BP</strong>” and save it in the Blueprints folder</li>
<li>Set the <strong>Static Mesh</strong> to <strong>SM_Cube</strong></li>
<li>Compile and Save</li>
</ol>
</section>
</section>
<section id="extending-the-pickup-class" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="extending-the-pickup-class"><span class="header-section-number">4</span> Extending the Pickup Class</h2>
<section id="creating-the-battery-pickup-class" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="creating-the-battery-pickup-class"><span class="header-section-number">4.1</span> Creating the Battery Pickup Class</h3>
<p>Create a new C++ class derived from Pickup:</p>
<ol type="1">
<li><strong>Tools → New C++ Class</strong></li>
<li>Click <strong>All Classes</strong> and search for “Pickup”</li>
<li>Select <strong>Pickup</strong> and click <strong>Next</strong></li>
<li>Name the class “<strong>BatteryPickup</strong>”</li>
</ol>
</section>
<section id="battery-pickup-header-file-batterypickup.h" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="battery-pickup-header-file-batterypickup.h"><span class="header-section-number">4.2</span> Battery Pickup Header File (BatteryPickup.h)</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Fill out your copyright notice in the Description page of Project Settings.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma once</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"CoreMinimal.h"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"Pickup.h"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"BatteryPickup.generated.h"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>UCLASS<span class="op">()</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BATTERYCOLLECTOR_API ABatteryPickup <span class="op">:</span> <span class="kw">public</span> APickup</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    GENERATED_BODY<span class="op">()</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    ABatteryPickup<span class="op">();</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Override the WasCollected function - use Implementation because it's a Blueprint Native Event */</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> WasCollected_Implementation<span class="op">()</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span><span class="op">:</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Set the amount of power the battery gives to the character */</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    UPROPERTY<span class="op">(</span>EditAnywhere<span class="op">,</span> BlueprintReadWrite<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Power"</span><span class="op">,</span> Meta <span class="op">=</span> <span class="op">(</span>BlueprintProtected <span class="op">=</span> <span class="st">"true"</span><span class="op">))</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> BatteryPower<span class="op">;</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Public way to access the battery's power level */</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> GetPower<span class="op">();</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="battery-pickup-source-file-batterypickup.cpp" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="battery-pickup-source-file-batterypickup.cpp"><span class="header-section-number">4.3</span> Battery Pickup Source File (BatteryPickup.cpp)</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Fill out your copyright notice in the Description page of Project Settings.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"BatteryPickup.h"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>ABatteryPickup<span class="op">::</span>ABatteryPickup<span class="op">()</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    GetMesh<span class="op">()-&gt;</span>SetSimulatePhysics<span class="op">(</span><span class="kw">true</span><span class="op">);</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The base power level of the battery</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    BatteryPower <span class="op">=</span> <span class="fl">150.</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ABatteryPickup<span class="op">::</span>WasCollected_Implementation<span class="op">()</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use the base pickup behavior</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    Super<span class="op">::</span>WasCollected_Implementation<span class="op">();</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Destroy the battery</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    Destroy<span class="op">();</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Report the power level of the battery</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> ABatteryPickup<span class="op">::</span>GetPower<span class="op">()</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> BatteryPower<span class="op">;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="setting-up-battery-collision" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="setting-up-battery-collision"><span class="header-section-number">4.4</span> Setting Up Battery Collision</h3>
<p>The battery needs collision to stop falling through the floor:</p>
<ol type="1">
<li>Open <strong>SM_Battery_Medium</strong> in the Static Mesh Editor</li>
<li>Click <strong>Collision → Add 18DOP Simplified Collision</strong></li>
<li>Save the mesh</li>
</ol>
</section>
<section id="creating-battery-blueprint" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="creating-battery-blueprint"><span class="header-section-number">4.5</span> Creating Battery Blueprint</h3>
<ol type="1">
<li>Right-click <strong>BatteryPickup</strong> and select <strong>Create Blueprint class based on BatteryPickup</strong></li>
<li>Name it “<strong>Battery_BP</strong>”</li>
<li>Set the <strong>Static Mesh</strong> to <strong>SM_Battery_Medium</strong></li>
<li>Compile and Save</li>
</ol>
</section>
</section>
<section id="creating-the-spawning-volume" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="creating-the-spawning-volume"><span class="header-section-number">5</span> Creating the Spawning Volume</h2>
<section id="spawn-volume-class" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="spawn-volume-class"><span class="header-section-number">5.1</span> Spawn Volume Class</h3>
<p>Create a new Actor class called “<strong>SpawnVolume</strong>”.</p>
</section>
<section id="spawn-volume-header-file-spawnvolume.h" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="spawn-volume-header-file-spawnvolume.h"><span class="header-section-number">5.2</span> Spawn Volume Header File (SpawnVolume.h)</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"CoreMinimal.h"</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"GameFramework/Actor.h"</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Components/BoxComponent.h&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Kismet/KismetMathLibrary.h&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"Pickup.h"</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"SpawnVolume.generated.h"</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>UCLASS<span class="op">()</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BATTERYCOLLECTOR_API ASpawnVolume <span class="op">:</span> <span class="kw">public</span> AActor</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    GENERATED_BODY<span class="op">()</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span>    </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Sets default values for this actor's properties</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    ASpawnVolume<span class="op">();</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span><span class="op">:</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Called when the game starts or when spawned</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">virtual</span> <span class="dt">void</span> BeginPlay<span class="op">()</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** The pickup to spawn */</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    UPROPERTY<span class="op">(</span>EditAnywhere<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Spawning"</span><span class="op">)</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    TSubclassOf<span class="op">&lt;</span><span class="kw">class</span> APickup<span class="op">&gt;</span> WhatToSpawn<span class="op">;</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    FTimerHandle SpawnTimer<span class="op">;</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Minimum spawn delay */</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    UPROPERTY<span class="op">(</span>EditAnywhere<span class="op">,</span> BlueprintReadWrite<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Spawning"</span><span class="op">)</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> SpawnDelayRangeLow<span class="op">;</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Maximum spawn delay */</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    UPROPERTY<span class="op">(</span>EditAnywhere<span class="op">,</span> BlueprintReadWrite<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Spawning"</span><span class="op">)</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> SpawnDelayRangeHigh<span class="op">;</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span>    </span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Called every frame</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">virtual</span> <span class="dt">void</span> Tick<span class="op">(</span><span class="dt">float</span> DeltaTime<span class="op">)</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Returns the WhereToSpawn subobject */</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    FORCEINLINE <span class="kw">class</span> UBoxComponent<span class="op">*</span> GetWhereToSpawn<span class="op">()</span> <span class="at">const</span> <span class="op">{</span> <span class="cf">return</span> WhereToSpawn<span class="op">;</span> <span class="op">}</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Find a random point within the BoxComponent */</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    UFUNCTION<span class="op">(</span>BlueprintPure<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Spawning"</span><span class="op">)</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    FVector GetRandomPointInVolume<span class="op">();</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** This function toggles whether or not the spawn volume spawns pickups */</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    UFUNCTION<span class="op">(</span>BlueprintCallable<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Spawning"</span><span class="op">)</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> SetSpawningActive<span class="op">(</span><span class="dt">bool</span> bShouldSpawn<span class="op">);</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Box Component to specify where the pickups should be spawned */</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    UPROPERTY<span class="op">(</span>VisibleAnywhere<span class="op">,</span> BlueprintReadOnly<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Spawning"</span><span class="op">,</span> meta <span class="op">=</span> <span class="op">(</span>AllowPrivateAccess <span class="op">=</span> <span class="st">"true"</span><span class="op">))</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    UBoxComponent<span class="op">*</span> WhereToSpawn<span class="op">;</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Handle spawning a new pickup */</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> SpawnPickup<span class="op">();</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** The current spawn delay */</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> SpawnDelay<span class="op">;</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="spawn-volume-source-file-spawnvolume.cpp" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="spawn-volume-source-file-spawnvolume.cpp"><span class="header-section-number">5.3</span> Spawn Volume Source File (SpawnVolume.cpp)</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"SpawnVolume.h"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Kismet/GameplayStatics.h&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Sets default values</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>ASpawnVolume<span class="op">::</span>ASpawnVolume<span class="op">()</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set this actor to call Tick() every frame. You can turn this off to improve performance if you don't need it.</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    PrimaryActorTick<span class="op">.</span>bCanEverTick <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create the Box Component to represent the spawn volume</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    WhereToSpawn <span class="op">=</span> CreateDefaultSubobject<span class="op">&lt;</span>UBoxComponent<span class="op">&gt;(</span>TEXT<span class="op">(</span><span class="st">"WhereToSpawn"</span><span class="op">));</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    RootComponent <span class="op">=</span> WhereToSpawn<span class="op">;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the spawn delay range</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    SpawnDelayRangeLow <span class="op">=</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    SpawnDelayRangeHigh <span class="op">=</span> <span class="fl">4.5</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Called when the game starts or when spawned</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ASpawnVolume<span class="op">::</span>BeginPlay<span class="op">()</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    Super<span class="op">::</span>BeginPlay<span class="op">();</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">// Called every frame</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ASpawnVolume<span class="op">::</span>Tick<span class="op">(</span><span class="dt">float</span> DeltaTime<span class="op">)</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    Super<span class="op">::</span>Tick<span class="op">(</span>DeltaTime<span class="op">);</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>FVector ASpawnVolume<span class="op">::</span>GetRandomPointInVolume<span class="op">()</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    FVector SpawnOrigin <span class="op">=</span> WhereToSpawn<span class="op">-&gt;</span>Bounds<span class="op">.</span>Origin<span class="op">;</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    FVector SpawnExtent <span class="op">=</span> WhereToSpawn<span class="op">-&gt;</span>Bounds<span class="op">.</span>BoxExtent<span class="op">;</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> UKismetMathLibrary<span class="op">::</span>RandomPointInBoundingBox<span class="op">(</span>SpawnOrigin<span class="op">,</span> SpawnExtent<span class="op">);</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ASpawnVolume<span class="op">::</span>SetSpawningActive<span class="op">(</span><span class="dt">bool</span> bShouldSpawn<span class="op">)</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bShouldSpawn<span class="op">)</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Set the timer on Spawn Pickup</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>        SpawnDelay <span class="op">=</span> FMath<span class="op">::</span>FRandRange<span class="op">(</span>SpawnDelayRangeLow<span class="op">,</span> SpawnDelayRangeHigh<span class="op">);</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>        GetWorldTimerManager<span class="op">().</span>SetTimer<span class="op">(</span>SpawnTimer<span class="op">,</span> <span class="kw">this</span><span class="op">,</span> <span class="op">&amp;</span>ASpawnVolume<span class="op">::</span>SpawnPickup<span class="op">,</span> SpawnDelay<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Clear the timer on Spawn Pickup</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>        GetWorldTimerManager<span class="op">().</span>ClearTimer<span class="op">(</span>SpawnTimer<span class="op">);</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ABatteryCollectorGameMode<span class="op">::</span>Tick<span class="op">(</span><span class="dt">float</span> DeltaTime<span class="op">)</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    Super<span class="op">::</span>Tick<span class="op">(</span>DeltaTime<span class="op">);</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check that we are using the battery collector character </span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>    ABatteryCollectorCharacter<span class="op">*</span> MyCharacter <span class="op">=</span> Cast<span class="op">&lt;</span>ABatteryCollectorCharacter<span class="op">&gt;(</span>UGameplayStatics<span class="op">::</span>GetPlayerPawn<span class="op">(</span><span class="kw">this</span><span class="op">,</span> <span class="dv">0</span><span class="op">));</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>MyCharacter<span class="op">)</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>        <span class="co">// If our power is greater than needed to win, set the game's state to Won</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>MyCharacter<span class="op">-&gt;</span>GetCurrentPower<span class="op">()</span> <span class="op">&gt;</span> PowerToWin<span class="op">)</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>            SetCurrentState<span class="op">(</span>EBatteryPlayState<span class="op">::</span>EWon<span class="op">);</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>        <span class="co">// If the character's power is positive</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>MyCharacter<span class="op">-&gt;</span>GetCurrentPower<span class="op">()</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Decrease the character's power using the decay rate</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>            MyCharacter<span class="op">-&gt;</span>UpdatePower<span class="op">(-</span>DeltaTime <span class="op">*</span> DecayRate <span class="op">*</span> <span class="op">(</span>MyCharacter<span class="op">-&gt;</span>GetInitialPower<span class="op">()));</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>            SetCurrentState<span class="op">(</span>EBatteryPlayState<span class="op">::</span>EGameOver<span class="op">);</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="final-setup-and-polish" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="final-setup-and-polish"><span class="header-section-number">6</span> Final Setup and Polish</h2>
<section id="creating-gamemode-blueprint" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="creating-gamemode-blueprint"><span class="header-section-number">6.1</span> Creating GameMode Blueprint</h3>
<ol type="1">
<li>Create a <strong>GameMode_BP</strong> Blueprint based on <strong>BatteryCollectorGameMode</strong></li>
<li>Set <strong>HUDWidget Class</strong> to <strong>BatteryHUD</strong></li>
<li>Set this as the <strong>Default GameMode</strong> in <strong>Project Settings → Maps &amp; Modes</strong></li>
</ol>
</section>
<section id="character-collision-setup" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="character-collision-setup"><span class="header-section-number">6.2</span> Character Collision Setup</h3>
<p>In <strong>BP_ThirdPersonCharacter</strong>:</p>
<ol type="1">
<li>Select the <strong>Mesh</strong> component</li>
<li>Set <strong>Collision Presets</strong> to <strong>Ragdoll</strong> (so the character collides when ragdolled)</li>
</ol>
</section>
<section id="level-polish" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="level-polish"><span class="header-section-number">6.3</span> Level Polish</h3>
<section id="spawn-volume-setup" class="level4" data-number="6.3.1">
<h4 data-number="6.3.1" class="anchored" data-anchor-id="spawn-volume-setup"><span class="header-section-number">6.3.1</span> Spawn Volume Setup</h4>
<ol type="1">
<li>Position the spawn volume above the room</li>
<li>Scale it to cover most of the playing area</li>
<li>Set appropriate spawn delay ranges</li>
<li>Ensure <strong>What to Spawn</strong> is set to <strong>Battery_BP</strong></li>
</ol>
</section>
<section id="lighting-and-visual-polish" class="level4" data-number="6.3.2">
<h4 data-number="6.3.2" class="anchored" data-anchor-id="lighting-and-visual-polish"><span class="header-section-number">6.3.2</span> Lighting and Visual Polish</h4>
<ol type="1">
<li>Build lighting for the final room setup</li>
<li>Adjust <strong>Decay Rate</strong> in <strong>GameMode_BP</strong> for balanced gameplay</li>
<li>Test win/lose conditions</li>
</ol>
</section>
</section>
<section id="hud-text-styling" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="hud-text-styling"><span class="header-section-number">6.4</span> HUD Text Styling</h3>
<p>In <strong>BatteryHUD</strong>:</p>
<ol type="1">
<li>Increase <strong>Font Size</strong> to 48 for better visibility</li>
<li>Set up proper anchoring for responsive design</li>
<li>Ensure text is centered and visible</li>
</ol>
</section>
</section>
<section id="testing-the-complete-game" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="testing-the-complete-game"><span class="header-section-number">7</span> Testing the Complete Game</h2>
<p>The completed game should have:</p>
<ul>
<li><strong>Character movement</strong> and collection mechanics</li>
<li><strong>Power system</strong> with visual feedback (color changes, speed changes)</li>
<li><strong>Battery spawning</strong> from spawn volumes</li>
<li><strong>Electric arc effects</strong> when collecting batteries</li>
<li><strong>HUD</strong> showing power level and game state</li>
<li><strong>Win condition</strong> when power exceeds PowerToWin threshold</li>
<li><strong>Lose condition</strong> when power reaches zero (with ragdoll effect)</li>
<li><strong>Game state management</strong> that stops spawning and disables input appropriately</li>
</ul>
</section>
<section id="exercises" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="exercises"><span class="header-section-number">8</span> Exercises</h2>
<p>Using what you have learned throughout this assignment, try to do the following:</p>
<section id="basic-extensions" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="basic-extensions"><span class="header-section-number">8.1</span> Basic Extensions</h3>
<ol type="1">
<li><strong>Character Glow Effect</strong>
<ul>
<li>Make your Character glow as you collect batteries</li>
<li>Hint: Use emissive materials or particle effects</li>
</ul></li>
<li><strong>Battery Counter</strong>
<ul>
<li>Show the number of batteries you have collected on a counter in the corner</li>
<li>Add a variable to track collected battery count</li>
</ul></li>
<li><strong>Night Scene</strong>
<ul>
<li>Make it a nighttime scene by playing with the sky sphere and the directional light</li>
<li>Experiment with atmospheric lighting</li>
</ul></li>
</ol>
</section>
<section id="intermediate-extensions" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="intermediate-extensions"><span class="header-section-number">8.2</span> Intermediate Extensions</h3>
<ol start="4" type="1">
<li><strong>Red Battery Variant</strong>
<ul>
<li>Create a copy of the original SM_Battery_Medium mesh</li>
<li>Change its material to become red instead of orange</li>
<li>Create a new type of Battery with 300 power</li>
</ul></li>
<li><strong>Special Pickup System</strong>
<ul>
<li>Create a new type of Spawn Volume with probability-based spawning</li>
<li>Add a probability parameter (default value = 0.1) for special battery pickups</li>
<li>Set the red battery as the special type of pickup</li>
</ul></li>
</ol>
</section>
<section id="advanced-extensions" class="level3" data-number="8.3">
<h3 data-number="8.3" class="anchored" data-anchor-id="advanced-extensions"><span class="header-section-number">8.3</span> Advanced Extensions</h3>
<ol start="6" type="1">
<li><strong>Enhanced Spawn Volume</strong>
<ul>
<li>Create a spawn volume that can spawn multiple pickup types</li>
<li>Implement weighted random selection for different pickup types</li>
<li>Add configuration for spawn probabilities per pickup type</li>
</ul></li>
</ol>
</section>
</section>
<section id="troubleshooting" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="troubleshooting"><span class="header-section-number">9</span> Troubleshooting</h2>
<section id="common-issues" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="common-issues"><span class="header-section-number">9.1</span> Common Issues</h3>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Batteries Falling Through Floor</strong> - Ensure collision is set up on SM_Battery_Medium - Use 18DOP Simplified Collision for better rolling behavior</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Character Not Ragdolling</strong> - Check that Mesh collision is set to “Ragdoll” preset - Ensure SetSimulatePhysics(true) is being called</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Spawn Volumes Not Working</strong> - Verify GameMode is finding and registering spawn volumes - Check that SetSpawningActive(true) is being called in EPlaying state - Ensure WhatToSpawn is set to a valid pickup class</p>
</div>
</div>
</section>
<section id="performance-considerations" class="level3" data-number="9.2">
<h3 data-number="9.2" class="anchored" data-anchor-id="performance-considerations"><span class="header-section-number">9.2</span> Performance Considerations</h3>
<ul>
<li><strong>Spawn Rate Balance</strong>: Too many spawned pickups can affect performance</li>
<li><strong>Particle Effects</strong>: Electric arcs create temporary particle systems</li>
<li><strong>Collection Sphere</strong>: Large radii may impact collision detection performance</li>
</ul>
</section>
</section>
<section id="conclusion" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">10</span> Conclusion</h2>
<p>This assignment demonstrates fundamental game development concepts in Unreal Engine 5 with C++:</p>
<ul>
<li><strong>Object-Oriented Design</strong>: Inheritance hierarchy with base and derived pickup classes</li>
<li><strong>Component-Based Architecture</strong>: Using UE5’s component system for modular functionality</li>
<li><strong>Game State Management</strong>: Implementing different game states with appropriate transitions</li>
<li><strong>UI Integration</strong>: Creating responsive HUDs with UMG</li>
<li><strong>Physics Integration</strong>: Combining physics simulation with gameplay mechanics</li>
<li><strong>Visual Effects</strong>: Particle systems and dynamic material changes</li>
<li><strong>Input Handling</strong>: Enhanced Input System integration</li>
</ul>
<p>The modular design allows for easy extension - new pickup types, different game modes, and additional mechanics can be added by following the established patterns.</p>
</section>
<section id="source-reference" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="source-reference"><span class="header-section-number">11</span> Source Reference</h2>
<p><strong>Source</strong>: <a href="https://www.youtube.com/playlist?list=PLZlv_N0_O1gYup-gvJtMsgJqnEB_dGiM4">https://www.youtube.com/playlist?list=PLZlv_N0_O1gYup-gvJtMsgJqnEB_dGiM4</a></p>
<hr>
<p><em>This document was converted from the original PDF assignment for the Games and Multimedia - Game Engines II course, Academic Year 2022/2023, 2nd Semester.</em></p>
<p>void ASpawnVolume::SpawnPickup() { // If we have something to spawn: if (WhatToSpawn != nullptr) { // Check for a valid World: UWorld* const World = GetWorld(); if (World) { // Set the spawn parameters FActorSpawnParameters SpawnParams; SpawnParams.Owner = this; SpawnParams.Instigator = GetInstigator();</p>
<pre><code>        // Get a random location to spawn at
        FVector SpawnLocation = GetRandomPointInVolume();
        
        // Get a random rotation for the spawned item
        FRotator SpawnRotation;
        SpawnRotation.Yaw = FMath::FRand() * 360.0f;
        SpawnRotation.Pitch = FMath::FRand() * 360.0f;
        SpawnRotation.Roll = FMath::FRand() * 360.0f;
        
        // Spawn the pickup
        APickup* const SpawnedPickup = World-&gt;SpawnActor&lt;APickup&gt;(WhatToSpawn, SpawnLocation, SpawnRotation, SpawnParams);
        
        SpawnDelay = FMath::FRandRange(SpawnDelayRangeLow, SpawnDelayRangeHigh);
        GetWorldTimerManager().SetTimer(SpawnTimer, this, &amp;ASpawnVolume::SpawnPickup, SpawnDelay, false);
    }
}</code></pre>
<p>}</p>
<pre><code>
### Setting Up Spawn Volumes in Level

1. Drag **SpawnVolume** directly into your level
2. Scale it appropriately using the **R** key
3. In the Details panel, set **What to Spawn** to **Battery_BP**
4. Adjust **Spawn Delay Range Low** and **High** values as needed

## Extending the Character Class

### Adding Collection Sphere

In **BatteryCollectorCharacter.h**, add the collection sphere:

```cpp
/** Collection sphere */
UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category = Pickups, meta = (AllowPrivateAccess = "true"))
class USphereComponent* CollectionSphere;

/** Return CollectionSphere subobject **/
FORCEINLINE class USphereComponent* GetCollectionSphere() const { return CollectionSphere; }</code></pre>
<p>In <strong>BatteryCollectorCharacter.cpp</strong> constructor:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Create the collection sphere</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>CollectionSphere <span class="op">=</span> CreateDefaultSubobject<span class="op">&lt;</span>USphereComponent<span class="op">&gt;(</span>TEXT<span class="op">(</span><span class="st">"CollectionSphere"</span><span class="op">));</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>CollectionSphere<span class="op">-&gt;</span>SetupAttachment<span class="op">(</span>RootComponent<span class="op">);</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>CollectionSphere<span class="op">-&gt;</span>SetSphereRadius<span class="op">(</span><span class="fl">200.</span><span class="bu">f</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="adding-collection-functions" class="level3" data-number="11.1">
<h3 data-number="11.1" class="anchored" data-anchor-id="adding-collection-functions"><span class="header-section-number">11.1</span> Adding Collection Functions</h3>
<p>Add to the header file:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">/** Called when we press a key to collect any pickups inside the CollectionSphere */</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>UFUNCTION<span class="op">(</span>BlueprintCallable<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Pickups"</span><span class="op">)</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> CollectPickups<span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="adding-pickup-collection-logic" class="level3" data-number="11.2">
<h3 data-number="11.2" class="anchored" data-anchor-id="adding-pickup-collection-logic"><span class="header-section-number">11.2</span> Adding Pickup Collection Logic</h3>
<p>In <strong>BatteryCollectorCharacter.cpp</strong>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"Pickup.h"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ABatteryCollectorCharacter<span class="op">::</span>CollectPickups<span class="op">()</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get all overlapping Actors and store them in an array</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    TArray<span class="op">&lt;</span>AActor<span class="op">*&gt;</span> CollectedActors<span class="op">;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    CollectionSphere<span class="op">-&gt;</span>GetOverlappingActors<span class="op">(</span>CollectedActors<span class="op">);</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// For each actor we collected</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>int32 iCollected <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> iCollected <span class="op">&lt;</span> CollectedActors<span class="op">.</span>Num<span class="op">();</span> <span class="op">++</span>iCollected<span class="op">)</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Cast the actor to APickup</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        APickup<span class="op">*</span> <span class="at">const</span> TestPickup <span class="op">=</span> Cast<span class="op">&lt;</span>APickup<span class="op">&gt;(</span>CollectedActors<span class="op">[</span>iCollected<span class="op">]);</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// If the cast is successful and the pickup is valid and active</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>TestPickup <span class="op">&amp;&amp;</span> IsValid<span class="op">(</span>TestPickup<span class="op">)</span> <span class="op">&amp;&amp;</span> TestPickup<span class="op">-&gt;</span>IsActive<span class="op">())</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Call the pickup's WasCollected function</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            TestPickup<span class="op">-&gt;</span>WasCollected<span class="op">();</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Deactivate the pickup</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>            TestPickup<span class="op">-&gt;</span>SetActive<span class="op">(</span><span class="kw">false</span><span class="op">);</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="setting-up-input" class="level3" data-number="11.3">
<h3 data-number="11.3" class="anchored" data-anchor-id="setting-up-input"><span class="header-section-number">11.3</span> Setting Up Input</h3>
<ol type="1">
<li>Create a new Input Action called <strong>IA_Collect</strong></li>
<li>Open <strong>IMC_Default</strong> and add a mapping for <strong>IA_Collect</strong> with the <strong>C</strong> key</li>
<li>In <strong>BatteryCollectorCharacter.h</strong>, add:</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">/** Collect Input Action */</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>UPROPERTY<span class="op">(</span>EditAnywhere<span class="op">,</span> BlueprintReadOnly<span class="op">,</span> Category <span class="op">=</span> Input<span class="op">,</span> meta <span class="op">=</span> <span class="op">(</span>AllowPrivateAccess <span class="op">=</span> <span class="st">"true"</span><span class="op">))</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UInputAction<span class="op">*</span> CollectAction<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="4" type="1">
<li>In <strong>BatteryCollectorCharacter.cpp</strong>, bind the action:</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>EnhancedInputComponent<span class="op">-&gt;</span>BindAction<span class="op">(</span>CollectAction<span class="op">,</span> ETriggerEvent<span class="op">::</span>Triggered<span class="op">,</span> <span class="kw">this</span><span class="op">,</span> <span class="op">&amp;</span>ABatteryCollectorCharacter<span class="op">::</span>CollectPickups<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="5" type="1">
<li>Set <strong>IA_Collect</strong> as the <strong>Collect Action</strong> in <strong>BP_ThirdPersonCharacter</strong></li>
</ol>
</section>
<section id="adding-wascollected-function-to-pickup" class="level3" data-number="11.4">
<h3 data-number="11.4" class="anchored" data-anchor-id="adding-wascollected-function-to-pickup"><span class="header-section-number">11.4</span> Adding WasCollected Function to Pickup</h3>
<p>In <strong>Pickup.h</strong>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">/** Function to call when the pickup is collected */</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>UFUNCTION<span class="op">(</span>BlueprintNativeEvent<span class="op">)</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> WasCollected<span class="op">();</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">virtual</span> <span class="dt">void</span> WasCollected_Implementation<span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In <strong>Pickup.cpp</strong>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> APickup<span class="op">::</span>WasCollected_Implementation<span class="op">()</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Log a debug message</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    FString PickupDebugString <span class="op">=</span> GetName<span class="op">();</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    UE_LOG<span class="op">(</span>LogClass<span class="op">,</span> Log<span class="op">,</span> TEXT<span class="op">(</span><span class="st">"You have collected </span><span class="sc">%s</span><span class="st">"</span><span class="op">),</span> <span class="op">*</span>PickupDebugString<span class="op">);</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="adding-power-to-the-game" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="adding-power-to-the-game"><span class="header-section-number">12</span> Adding Power to the Game</h2>
<section id="character-power-system" class="level3" data-number="12.1">
<h3 data-number="12.1" class="anchored" data-anchor-id="character-power-system"><span class="header-section-number">12.1</span> Character Power System</h3>
<p>Add to <strong>BatteryCollectorCharacter.h</strong>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span><span class="op">:</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** The starting power level of our character */</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    UPROPERTY<span class="op">(</span>EditAnywhere<span class="op">,</span> BlueprintReadWrite<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Power"</span><span class="op">,</span> Meta <span class="op">=</span> <span class="op">(</span>BlueprintProtected <span class="op">=</span> <span class="st">"true"</span><span class="op">))</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> InitialPower<span class="op">;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Multiplier for character speed */</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    UPROPERTY<span class="op">(</span>EditAnywhere<span class="op">,</span> BlueprintReadWrite<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Power"</span><span class="op">,</span> Meta <span class="op">=</span> <span class="op">(</span>BlueprintProtected <span class="op">=</span> <span class="st">"true"</span><span class="op">))</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> SpeedFactor<span class="op">;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Speed when power level = 0 */</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    UPROPERTY<span class="op">(</span>EditAnywhere<span class="op">,</span> BlueprintReadWrite<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Power"</span><span class="op">,</span> Meta <span class="op">=</span> <span class="op">(</span>BlueprintProtected <span class="op">=</span> <span class="st">"true"</span><span class="op">))</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> BaseSpeed<span class="op">;</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Current power level of our character */</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    UPROPERTY<span class="op">(</span>VisibleAnywhere<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> CharacterPower<span class="op">;</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Accessor function for initial power */</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    UFUNCTION<span class="op">(</span>BlueprintPure<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> GetInitialPower<span class="op">();</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Accessor function for current power */</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    UFUNCTION<span class="op">(</span>BlueprintPure<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> GetCurrentPower<span class="op">();</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="co">    Function to update the character's power </span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co">    * </span><span class="an">@param</span><span class="co"> </span><span class="cv">PowerChange</span><span class="co"> This is the amount to change the power by, and it can be positive or negative.</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    UFUNCTION<span class="op">(</span>BlueprintCallable<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> UpdatePower<span class="op">(</span><span class="dt">float</span> PowerChange<span class="op">);</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span><span class="op">:</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    UFUNCTION<span class="op">(</span>BlueprintImplementableEvent<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> PowerChangeEffect<span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="character-power-implementation" class="level3" data-number="12.2">
<h3 data-number="12.2" class="anchored" data-anchor-id="character-power-implementation"><span class="header-section-number">12.2</span> Character Power Implementation</h3>
<p>In <strong>BatteryCollectorCharacter.cpp</strong> constructor:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Set a base power level for the character</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>InitialPower <span class="op">=</span> <span class="fl">2000.</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>CharacterPower <span class="op">=</span> InitialPower<span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Set the dependence of the speed on the power level</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>SpeedFactor <span class="op">=</span> <span class="fl">0.75</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>BaseSpeed <span class="op">=</span> <span class="fl">10.</span><span class="bu">f</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Add the accessor and update functions:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Reports starting power</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> ABatteryCollectorCharacter<span class="op">::</span>GetInitialPower<span class="op">()</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> InitialPower<span class="op">;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Reports current power</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> ABatteryCollectorCharacter<span class="op">::</span>GetCurrentPower<span class="op">()</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> CharacterPower<span class="op">;</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Called whenever power is increased or decreased</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ABatteryCollectorCharacter<span class="op">::</span>UpdatePower<span class="op">(</span><span class="dt">float</span> PowerChange<span class="op">)</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Change power</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    CharacterPower <span class="op">=</span> CharacterPower <span class="op">+</span> PowerChange<span class="op">;</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Change speed based on power</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    GetCharacterMovement<span class="op">()-&gt;</span>MaxWalkSpeed <span class="op">=</span> BaseSpeed <span class="op">+</span> SpeedFactor <span class="op">*</span> CharacterPower<span class="op">;</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Call visual effect</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    PowerChangeEffect<span class="op">();</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="powering-up-from-batteries" class="level3" data-number="12.3">
<h3 data-number="12.3" class="anchored" data-anchor-id="powering-up-from-batteries"><span class="header-section-number">12.3</span> Powering Up from Batteries</h3>
<p>Update the <strong>CollectPickups</strong> function:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ABatteryCollectorCharacter<span class="op">::</span>CollectPickups<span class="op">()</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get all overlapping Actors and store them in an array</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    TArray<span class="op">&lt;</span>AActor<span class="op">*&gt;</span> CollectedActors<span class="op">;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    CollectionSphere<span class="op">-&gt;</span>GetOverlappingActors<span class="op">(</span>CollectedActors<span class="op">);</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Keep track of the collected power</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> CollectedPower <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// For each actor we collected</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>int32 iCollected <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> iCollected <span class="op">&lt;</span> CollectedActors<span class="op">.</span>Num<span class="op">();</span> <span class="op">++</span>iCollected<span class="op">)</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Cast the actor to APickup</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        APickup<span class="op">*</span> <span class="at">const</span> TestPickup <span class="op">=</span> Cast<span class="op">&lt;</span>APickup<span class="op">&gt;(</span>CollectedActors<span class="op">[</span>iCollected<span class="op">]);</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// If the cast is successful and the pickup is valid and active</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>TestPickup <span class="op">&amp;&amp;</span> IsValid<span class="op">(</span>TestPickup<span class="op">)</span> <span class="op">&amp;&amp;</span> TestPickup<span class="op">-&gt;</span>IsActive<span class="op">())</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Call the pickup's WasCollected function</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>            TestPickup<span class="op">-&gt;</span>WasCollected<span class="op">();</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Check to see if the pickup is also a battery</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>            ABatteryPickup<span class="op">*</span> <span class="at">const</span> TestBattery <span class="op">=</span> Cast<span class="op">&lt;</span>ABatteryPickup<span class="op">&gt;(</span>TestPickup<span class="op">);</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>TestBattery<span class="op">)</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Increase the collected power</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>                CollectedPower <span class="op">+=</span> TestBattery<span class="op">-&gt;</span>GetPower<span class="op">();</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Deactivate the pickup</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>            TestPickup<span class="op">-&gt;</span>SetActive<span class="op">(</span><span class="kw">false</span><span class="op">);</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>CollectedPower <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>        UpdatePower<span class="op">(</span>CollectedPower<span class="op">);</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="gamemode-power-drain" class="level2" data-number="13">
<h2 data-number="13" class="anchored" data-anchor-id="gamemode-power-drain"><span class="header-section-number">13</span> GameMode Power Drain</h2>
<section id="gamemode-power-system" class="level3" data-number="13.1">
<h3 data-number="13.1" class="anchored" data-anchor-id="gamemode-power-system"><span class="header-section-number">13.1</span> GameMode Power System</h3>
<p>Add to <strong>BatteryCollectorGameMode.h</strong>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span><span class="op">:</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** The rate at which the character loses power */</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    UPROPERTY<span class="op">(</span>EditDefaultsOnly<span class="op">,</span> BlueprintReadWrite<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Power"</span><span class="op">,</span> Meta <span class="op">=</span> <span class="op">(</span>BlueprintProtected <span class="op">=</span> <span class="kw">true</span><span class="op">))</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> DecayRate<span class="op">;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** The power needed to win the game */</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    UPROPERTY<span class="op">(</span>EditDefaultsOnly<span class="op">,</span> BlueprintReadWrite<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Power"</span><span class="op">,</span> Meta <span class="op">=</span> <span class="op">(</span>BlueprintProtected <span class="op">=</span> <span class="kw">true</span><span class="op">))</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> PowerToWin<span class="op">;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">virtual</span> <span class="dt">void</span> Tick<span class="op">(</span><span class="dt">float</span> DeltaTime<span class="op">)</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">virtual</span> <span class="dt">void</span> BeginPlay<span class="op">()</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Returns the power needed to win - needed for the HUD */</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    UFUNCTION<span class="op">(</span>BlueprintPure<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> GetPowerToWin<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="gamemode-implementation" class="level3" data-number="13.2">
<h3 data-number="13.2" class="anchored" data-anchor-id="gamemode-implementation"><span class="header-section-number">13.2</span> GameMode Implementation</h3>
<p>In <strong>BatteryCollectorGameMode.cpp</strong> constructor:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Base decay rate</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>DecayRate <span class="op">=</span> <span class="fl">0.01</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>PrimaryActorTick<span class="op">.</span>bCanEverTick <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Add the implementation:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Kismet/GameplayStatics.h&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ABatteryCollectorGameMode<span class="op">::</span>BeginPlay<span class="op">()</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    Super<span class="op">::</span>BeginPlay<span class="op">();</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set score to beat</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    ABatteryCollectorCharacter<span class="op">*</span> MyCharacter <span class="op">=</span> Cast<span class="op">&lt;</span>ABatteryCollectorCharacter<span class="op">&gt;(</span>UGameplayStatics<span class="op">::</span>GetPlayerPawn<span class="op">(</span><span class="kw">this</span><span class="op">,</span> <span class="dv">0</span><span class="op">));</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>MyCharacter<span class="op">)</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        PowerToWin <span class="op">=</span> <span class="op">(</span>MyCharacter<span class="op">-&gt;</span>GetInitialPower<span class="op">())</span> <span class="op">*</span> <span class="fl">1.25</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ABatteryCollectorGameMode<span class="op">::</span>Tick<span class="op">(</span><span class="dt">float</span> DeltaTime<span class="op">)</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    Super<span class="op">::</span>Tick<span class="op">(</span>DeltaTime<span class="op">);</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check that we are using the battery collector character </span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    ABatteryCollectorCharacter<span class="op">*</span> MyCharacter <span class="op">=</span> Cast<span class="op">&lt;</span>ABatteryCollectorCharacter<span class="op">&gt;(</span>UGameplayStatics<span class="op">::</span>GetPlayerPawn<span class="op">(</span><span class="kw">this</span><span class="op">,</span> <span class="dv">0</span><span class="op">));</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>MyCharacter<span class="op">)</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">// If the character's power is positive</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>MyCharacter<span class="op">-&gt;</span>GetCurrentPower<span class="op">()</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Decrease the character's power using the decay rate</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>            MyCharacter<span class="op">-&gt;</span>UpdatePower<span class="op">(-</span>DeltaTime <span class="op">*</span> DecayRate <span class="op">*</span> <span class="op">(</span>MyCharacter<span class="op">-&gt;</span>GetInitialPower<span class="op">()));</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> ABatteryCollectorGameMode<span class="op">::</span>GetPowerToWin<span class="op">()</span> <span class="at">const</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> PowerToWin<span class="op">;</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="character-visual-effects" class="level2" data-number="14">
<h2 data-number="14" class="anchored" data-anchor-id="character-visual-effects"><span class="header-section-number">14</span> Character Visual Effects</h2>
<section id="material-color-changes" class="level3" data-number="14.1">
<h3 data-number="14.1" class="anchored" data-anchor-id="material-color-changes"><span class="header-section-number">14.1</span> Material Color Changes</h3>
<p>In <strong>BP_ThirdPersonCharacter</strong>, set up the <strong>PowerChangeEffect</strong> Blueprint event:</p>
<ol type="1">
<li>Create a <strong>Dynamic Material Instance</strong> in the Construction Script</li>
<li>In the Event Graph, create an <strong>Event PowerChangeEffect</strong></li>
<li>Set up a <strong>Lerp</strong> between two colors based on Current Power / Initial Power ratio</li>
<li>Use <strong>Set Vector Parameter Value</strong> to change the material tint</li>
</ol>
</section>
<section id="speed-changes" class="level3" data-number="14.2">
<h3 data-number="14.2" class="anchored" data-anchor-id="speed-changes"><span class="header-section-number">14.2</span> Speed Changes</h3>
<p>The speed changes are already implemented in the <strong>UpdatePower</strong> function in C++, where <strong>MaxWalkSpeed</strong> is updated based on the character’s power level.</p>
</section>
</section>
<section id="creating-particle-effects" class="level2" data-number="15">
<h2 data-number="15" class="anchored" data-anchor-id="creating-particle-effects"><span class="header-section-number">15</span> Creating Particle Effects</h2>
<section id="electric-arc-material" class="level3" data-number="15.1">
<h3 data-number="15.1" class="anchored" data-anchor-id="electric-arc-material"><span class="header-section-number">15.1</span> Electric Arc Material</h3>
<ol type="1">
<li>Create a new <strong>Material</strong> called <strong>M_ElectricArc</strong></li>
<li>Set <strong>Shading Model</strong> to <strong>Unlit</strong></li>
<li>Connect <strong>Particle Color</strong> to <strong>Emissive Color</strong></li>
</ol>
</section>
<section id="niagara-particle-system" class="level3" data-number="15.2">
<h3 data-number="15.2" class="anchored" data-anchor-id="niagara-particle-system"><span class="header-section-number">15.2</span> Niagara Particle System</h3>
<ol type="1">
<li>Create a new <strong>Niagara System</strong> called <strong>P_ElectricArcs</strong></li>
<li>Use <strong>Static Beam</strong> emitter</li>
<li>Set up <strong>BeamEnd</strong> as a user-exposed parameter</li>
<li>Configure material and beam properties</li>
</ol>
</section>
<section id="adding-particles-to-battery" class="level3" data-number="15.3">
<h3 data-number="15.3" class="anchored" data-anchor-id="adding-particles-to-battery"><span class="header-section-number">15.3</span> Adding Particles to Battery</h3>
<p>In <strong>Battery_BP</strong>, add the particle effect to the <strong>WasCollected</strong> event:</p>
<ol type="1">
<li><strong>Spawn System Attached</strong> with <strong>P_ElectricArcs</strong></li>
<li>Get the player character’s socket location</li>
<li>Set the <strong>BeamEnd</strong> parameter to target the character</li>
<li>Add delay and parent function call</li>
</ol>
</section>
</section>
<section id="hud-system" class="level2" data-number="16">
<h2 data-number="16" class="anchored" data-anchor-id="hud-system"><span class="header-section-number">16</span> HUD System</h2>
<section id="enabling-umg" class="level3" data-number="16.1">
<h3 data-number="16.1" class="anchored" data-anchor-id="enabling-umg"><span class="header-section-number">16.1</span> Enabling UMG</h3>
<p>Add to <strong>BatteryCollector.Build.cs</strong>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode cs code-with-copy"><code class="sourceCode cs"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>PublicDependencyModuleNames<span class="op">.</span><span class="fu">AddRange</span><span class="op">(</span><span class="kw">new</span> <span class="dt">string</span><span class="op">[]</span> <span class="op">{</span> <span class="st">"Core"</span><span class="op">,</span> <span class="st">"CoreUObject"</span><span class="op">,</span> <span class="st">"Engine"</span><span class="op">,</span> <span class="st">"InputCore"</span><span class="op">,</span> <span class="st">"HeadMountedDisplay"</span><span class="op">,</span> <span class="st">"UMG"</span><span class="op">});</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>PrivateDependencyModuleNames<span class="op">.</span><span class="fu">AddRange</span><span class="op">(</span><span class="kw">new</span> <span class="dt">string</span><span class="op">[]</span> <span class="op">{</span> <span class="st">"Slate"</span><span class="op">,</span> <span class="st">"SlateCore"</span> <span class="op">});</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="gamemode-hud-setup" class="level3" data-number="16.2">
<h3 data-number="16.2" class="anchored" data-anchor-id="gamemode-hud-setup"><span class="header-section-number">16.2</span> GameMode HUD Setup</h3>
<p>Add to <strong>BatteryCollectorGameMode.h</strong>:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;UserWidget.h&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span><span class="op">:</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** The Widget class to use for our HUD screen */</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    UPROPERTY<span class="op">(</span>EditDefaultsOnly<span class="op">,</span> BlueprintReadWrite<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Power"</span><span class="op">,</span> Meta <span class="op">=</span> <span class="op">(</span>BlueprintProtected <span class="op">=</span> <span class="kw">true</span><span class="op">))</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    TSubclassOf<span class="op">&lt;</span><span class="kw">class</span> UUserWidget<span class="op">&gt;</span> HUDWidgetClass<span class="op">;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** The instance of the HUD */</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    UPROPERTY<span class="op">()</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> UUserWidget<span class="op">*</span> CurrentWidget<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In <strong>BeginPlay</strong>, add:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>HUDWidgetClass <span class="op">!=</span> <span class="kw">nullptr</span><span class="op">)</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    CurrentWidget <span class="op">=</span> CreateWidget<span class="op">&lt;</span>UUserWidget<span class="op">&gt;(</span>GetWorld<span class="op">(),</span> HUDWidgetClass<span class="op">);</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>CurrentWidget <span class="op">!=</span> <span class="kw">nullptr</span><span class="op">)</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        CurrentWidget<span class="op">-&gt;</span>AddToViewport<span class="op">();</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="hud-blueprint" class="level3" data-number="16.3">
<h3 data-number="16.3" class="anchored" data-anchor-id="hud-blueprint"><span class="header-section-number">16.3</span> HUD Blueprint</h3>
<p>Create <strong>BatteryHUD</strong> Widget Blueprint with:</p>
<ol type="1">
<li><strong>Progress Bar</strong> for power level</li>
<li><strong>Text Block</strong> for game state messages</li>
<li>Bind progress bar to <strong>Current Power / Power To Win</strong></li>
<li>Bind text to game state messages</li>
</ol>
</section>
</section>
<section id="game-states" class="level2" data-number="17">
<h2 data-number="17" class="anchored" data-anchor-id="game-states"><span class="header-section-number">17</span> Game States</h2>
<section id="play-state-enum" class="level3" data-number="17.1">
<h3 data-number="17.1" class="anchored" data-anchor-id="play-state-enum"><span class="header-section-number">17.1</span> Play State Enum</h3>
<p>Add to <strong>BatteryCollectorGameMode.h</strong>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Enum to store the current state of gameplay</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>UENUM<span class="op">(</span>BlueprintType<span class="op">)</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> <span class="kw">class</span> EBatteryPlayState <span class="op">:</span> uint8</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    EPlaying<span class="op">,</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    EGameOver<span class="op">,</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    EWon<span class="op">,</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    EUnknown</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Keeps track of the current playing state */</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    EBatteryPlayState CurrentState<span class="op">;</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    TArray<span class="op">&lt;</span><span class="kw">class</span> ASpawnVolume<span class="op">*&gt;</span> SpawnVolumeActors<span class="op">;</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Handle any function calls that rely upon changing the playing state of our game */</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> HandleNewState<span class="op">(</span>EBatteryPlayState NewState<span class="op">);</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Returns the current playing state */</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    UFUNCTION<span class="op">(</span>BlueprintPure<span class="op">,</span> Category <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    EBatteryPlayState GetCurrentState<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">/** Sets a new playing state */</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> SetCurrentState<span class="op">(</span>EBatteryPlayState NewState<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="state-management-implementation" class="level3" data-number="17.2">
<h3 data-number="17.2" class="anchored" data-anchor-id="state-management-implementation"><span class="header-section-number">17.2</span> State Management Implementation</h3>
<p>```cpp #include “SpawnVolume.h”</p>
<p>void ABatteryCollectorGameMode::BeginPlay() { Super::BeginPlay();</p>
<pre><code>// Find all spawn volume Actors
TArray&lt;AActor*&gt; FoundActors;
UGameplayStatics::GetAllActorsOfClass(GetWorld(), ASpawnVolume::StaticClass(), FoundActors);

for (auto Actor : FoundActors)
{
    ASpawnVolume* SpawnVolumeActor = Cast&lt;ASpawnVolume&gt;(Actor);
    if (SpawnVolumeActor)
    {
        SpawnVolumeActors.AddUnique(SpawnVolumeActor);
    }
}

SetCurrentState(EBatteryPlayState::EPlaying);

// Set score to beat
ABatteryCollectorCharacter* MyCharacter = Cast&lt;ABatteryCollectorCharacter&gt;(UGameplayStatics::GetPlayerPawn(this, 0));
if (MyCharacter)
{
    PowerToWin = (MyCharacter-&gt;GetInitialPower()) * 1.25f;
}

if (HUDWidgetClass != nullptr)
{
    CurrentWidget = CreateWidget&lt;UUserWidget&gt;(GetWorld(), HUDWidgetClass);
    if (CurrentWidget != nullptr)
    {
        CurrentWidget-&gt;AddToViewport();
    }
}</code></pre>
<p>}</p>
<p>EBatteryPlayState ABatteryCollectorGameMode::GetCurrentState() const { return CurrentState; }</p>
<p>void ABatteryCollectorGameMode::SetCurrentState(EBatteryPlayState NewState) { // Set current state CurrentState = NewState; // Handle the new current state HandleNewState(CurrentState); }</p>
<p>void ABatteryCollectorGameMode::HandleNewState(EBatteryPlayState NewState) { switch (NewState) { // If the game is playing case EBatteryPlayState::EPlaying: { // Spawn volumes active for (ASpawnVolume* Volume : SpawnVolumeActors) { Volume-&gt;SetSpawningActive(true); } } break;</p>
<pre><code>    // If we've won the game 
    case EBatteryPlayState::EWon:
    {
        // Spawn volumes inactive
        for (ASpawnVolume* Volume : SpawnVolumeActors)
        {
            Volume-&gt;SetSpawningActive(false);
        }
    }
    break;
    
    // If we've lost the game
    case EBatteryPlayState::EGameOver:
    {
        // Spawn volumes inactive
        for (ASpawnVolume* Volume : SpawnVolumeActors)
        {
            Volume-&gt;SetSpawningActive(false);
        }
        
        // Block player input
        APlayerController* PlayerController = UGameplayStatics::GetPlayerController(this, 0);
        if (PlayerController)
        {
            PlayerController-&gt;SetCinematicMode(true, false, false, true, true);
        }
        
        // Ragdoll the character
        ACharacter* MyCharacter = UGameplayStatics::GetPlayerCharacter(this, 0);
        if (MyCharacter)
        {
            MyCharacter-&gt;GetMesh()-&gt;SetSimulatePhysics(true);
            MyCharacter-&gt;GetMovementComponent()-&gt;MovementState.bCanJump = false;
        }
    }
    break;
    
    // Unknown/default state
    default:
    case EBatteryPlayState::EUnknown:
    {
        // Do nothing
    }
    break;
}</code></pre>
<p>}</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>